<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Silence: Panic Mode</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&display=swap');

        /* STRICT MOBILE LOCK: Prevents scrolling, zooming, and refreshing */
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: #000; display: flex; justify-content: center; align-items: center; 
            font-family: 'Creepster', cursive; overflow: hidden; 
            touch-action: none; overscroll-behavior: none; -webkit-user-select: none; user-select: none;
            -webkit-touch-callout: none;
        }
        
        #game-container { position: relative; width: 100%; height: 100%; max-width: 600px; background: #050000; }
        canvas { display: block; width: 100%; height: 100%; }

        /* --- UI STYLING --- */
        #ui { 
            position: absolute; top: 15px; width: 100%; color: #ff0000; 
            pointer-events: none; text-shadow: 2px 2px 0 #000, 0 0 15px #ff0000; z-index: 10; 
            display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box;
            align-items: flex-start;
        }
        
        .ui-left { text-align: left; }
        .ui-right { text-align: right; }
        
        h1 { margin: 0; font-size: 30px; letter-spacing: 2px; }
        .status-safe { color: #555; text-shadow: none; }
        .status-warn { color: #ffff00; text-shadow: 0 0 10px #ffff00; }
        .status-danger { color: #ff0000; text-shadow: 0 0 20px #ff0000; font-size: 35px;}

        /* Panic Meter UI */
        .panic-container { width: 120px; height: 15px; border: 2px solid #fff; margin-top: 5px; background: #222; position: relative;}
        #panic-bar { width: 0%; height: 100%; background: #ff0000; transition: width 0.1s; }
        .panic-text { font-family: sans-serif; font-size: 14px; font-weight: bold; color: white; text-shadow: 1px 1px 0 #000; margin-top: 2px;}

        /* --- MENUS --- */
        #center-ui {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; pointer-events: auto; z-index: 20; width: 90%;
        }

        .instruction { font-size: 18px; color: #fff; font-family: sans-serif; margin-bottom: 25px; text-shadow: 2px 2px 5px #000; line-height: 1.5;}
        .instruction span { color: #ff0000; font-weight: bold; font-size: 20px; }
        .crash-text { color: #ff0000; font-size: 50px; text-transform: uppercase; text-shadow: 0 0 30px #ff0000; margin-bottom: 10px; display: none; line-height: 1;}
        
        #start-btn {
            padding: 15px 40px; font-size: 30px; background: rgba(0,0,0,0.9); color: #ff0000;
            border: 3px solid #ff0000; border-radius: 5px; cursor: pointer;
            box-shadow: 0 0 20px rgba(255,0,0,0.6), inset 0 0 10px rgba(255,0,0,0.6); 
            font-family: 'Creepster', cursive; letter-spacing: 2px;
        }

        /* Glitch Effect */
        @keyframes glitch {
            0% { filter: invert(0); transform: translate(0); }
            20% { filter: invert(1); transform: translate(-5px, 5px); }
            40% { filter: invert(0); transform: translate(5px, -5px); }
            60% { filter: invert(1); transform: translate(-5px, -5px); }
            80% { filter: invert(0); transform: translate(5px, 5px); }
            100% { filter: invert(0); transform: translate(0); }
        }
        .glitching { animation: glitch 0.3s infinite; }
        
        #jumpscare {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.1);
            width: 100%; height: 100%; object-fit: cover; opacity: 0; pointer-events: none; z-index: 15;
            transition: all 0.1s;
        }
        .scare-active { transform: translate(-50%, -50%) scale(1.2) !important; opacity: 1 !important; }
    </style>
</head>
<body>

    <div id="game-container">
        <img id="jumpscare" src="" alt="scare">
        
        <div id="ui">
            <div class="ui-left">
                <h1 id="level">STAGE: 1</h1>
                <div class="panic-text">PANIC METER</div>
                <div class="panic-container"><div id="panic-bar"></div></div>
            </div>
            <div class="ui-right">
                <h1 id="status" class="status-safe">SAFE</h1>
            </div>
        </div>

        <div id="center-ui">
            <div id="crash-msg" class="crash-text">THEY HEARD YOU</div>
            <div id="instructions" class="instruction">
                1. <span>PRESS & HOLD</span> to crawl forward.<br>
                2. <span>DRAG</span> left/right to dodge blood traps.<br>
                3. <span>RELEASE</span> to freeze & lower panic.<br>
                4. Do not move when their eyes open.
            </div>
            <button id="start-btn">BEGIN ESCAPE</button>
        </div>
        
        <canvas id="gameCanvas"></canvas>
    </div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const levelEl = document.getElementById('level');
const statusEl = document.getElementById('status');
const panicBar = document.getElementById('panic-bar');
const startBtn = document.getElementById('start-btn');
const crashMsg = document.getElementById('crash-msg');
const instructions = document.getElementById('instructions');
const gameContainer = document.getElementById('game-container');
const jumpscareImg = document.getElementById('jumpscare');

function resizeCanvas() {
    canvas.width = window.innerWidth > 600 ? 600 : window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// --- 1. AUDIO SETUP ---
const bgMusic = new Audio('https://raw.githubusercontent.com/thesaching/flappy-binsu-game/refs/heads/main/kir.mp3');
bgMusic.loop = true;
bgMusic.volume = 0.9; 
let audioUnlocked = false;

function unlockAudio() {
    if (!audioUnlocked) {
        bgMusic.play().catch(err => console.log("Audio waiting for interaction."));
        audioUnlocked = true;
    }
}

// --- 2. LOAD IMAGES ---
const sonImg = new Image(); sonImg.crossOrigin = "anonymous";
sonImg.src = 'https://raw.githubusercontent.com/thesaching/flappy-binsu-game/refs/heads/main/varu.jpeg'; 

const fatherImg = new Image(); fatherImg.crossOrigin = "anonymous";
fatherImg.src = 'https://raw.githubusercontent.com/thesaching/flappy-binsu-game/refs/heads/main/easha.jpeg'; 

const motherImg = new Image(); motherImg.crossOrigin = "anonymous";
motherImg.src = 'https://raw.githubusercontent.com/thesaching/flappy-binsu-game/refs/heads/main/kavitha.jpeg'; 

// --- 3. GAME VARIABLES ---
let gameState = 'IDLE'; 
let stage = 1;
let frames = 0;
let isMoving = false; 

// Player Mechanics
let playerSize = 55;
let playerY = canvas.height - 120;
let playerX = canvas.width / 2;
let targetX = playerX; // For smooth steering
let baseSpeed = 4;
let currentSpeed = baseSpeed;

// Panic Mechanic
let panicLevel = 0; // 0 to 100

// Traps (Blood Pools)
let traps = [];

// The Creeping Death (Shadow)
let shadowY = canvas.height;
let shadowSpeed = 0.8;

// Monster State
let monsterState = 'SLEEP';
let stateTimer = 100; 

// --- 4. GAME LOGIC ---
function spawnTraps() {
    traps = [];
    let numTraps = 2 + stage; // More traps on higher stages
    for(let i=0; i<numTraps; i++) {
        traps.push({
            x: Math.random() * (canvas.width - 60),
            y: 150 + Math.random() * (canvas.height - 400),
            w: 60 + Math.random() * 40,
            h: 30 + Math.random() * 20
        });
    }
}

function updateMonsterLogic() {
    stateTimer--;

    if (stateTimer <= 0) {
        if (monsterState === 'SLEEP') {
            monsterState = 'WARNING';
            stateTimer = 15 + Math.random() * 15; // Shorter warning!
            gameContainer.classList.add('glitching');
            statusEl.innerText = "!";
            statusEl.className = "status-warn";
        } 
        else if (monsterState === 'WARNING') {
            monsterState = 'AWAKE';
            stateTimer = 40 + Math.random() * 60; 
            gameContainer.classList.remove('glitching');
            statusEl.innerText = "DON'T MOVE";
            statusEl.className = "status-danger";
        } 
        else if (monsterState === 'AWAKE') {
            monsterState = 'SLEEP';
            stateTimer = Math.max(30, (120 - (stage * 8)) + Math.random() * 80); 
            statusEl.innerText = "SAFE";
            statusEl.className = "status-safe";
        }
    }
}

// --- 5. MAIN LOOP ---
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (gameState === 'PLAYING') {
        frames++;
        updateMonsterLogic();

        // 1. UPDATE PLAYER & PANIC
        if (isMoving) {
            // Panic goes up while crawling
            panicLevel += 0.6;
            
            // Steer left/right smoothly
            playerX += (targetX - playerX) * 0.15;
            
            // Trap Collision (Slow down if in blood pool)
            let inTrap = false;
            for(let t of traps) {
                if (playerX < t.x + t.w && playerX + playerSize > t.x &&
                    playerY < t.y + t.h && playerY + playerSize > t.y) {
                    inTrap = true;
                    break;
                }
            }
            
            currentSpeed = inTrap ? baseSpeed * 0.3 : baseSpeed;
            playerY -= currentSpeed;
            
            // Movement Trail
            ctx.fillStyle = "rgba(255,0,0,0.1)";
            ctx.fillRect(playerX, playerY, playerSize, playerSize + 20);
            
        } else {
            // Panic drops quickly when frozen
            panicLevel = Math.max(0, panicLevel - 1.5);
        }

        // Update Panic UI
        panicBar.style.width = panicLevel + "%";
        panicBar.style.background = panicLevel > 80 ? "#ff0000" : "#fff";

        // Keep player in bounds
        playerX = Math.max(0, Math.min(canvas.width - playerSize, playerX));

        // 2. UPDATE CREEPING SHADOW
        shadowY -= shadowSpeed;

        // --- DRAWING ---

        // Draw Exit
        ctx.fillStyle = "#00e5ff"; ctx.fillRect(0, 80, canvas.width, 5);
        ctx.fillStyle = "#fff"; ctx.font = "20px sans-serif"; ctx.fillText("ESCAPE", canvas.width/2 - 40, 70);

        // Draw Blood Traps
        ctx.fillStyle = "rgba(139, 0, 0, 0.6)"; // Dark blood red
        for(let t of traps) {
            ctx.beginPath(); ctx.ellipse(t.x + t.w/2, t.y + t.h/2, t.w/2, t.h/2, 0, 0, Math.PI*2); ctx.fill();
        }

        // Draw Parents (Top)
        if (fatherImg.complete && motherImg.complete) {
            ctx.save();
            if (monsterState === 'SLEEP') ctx.globalAlpha = 0.1; 
            else if (monsterState === 'WARNING') { ctx.globalAlpha = 0.6; ctx.translate(Math.random()*8-4, Math.random()*8-4); } 
            else if (monsterState === 'AWAKE') ctx.globalAlpha = 1.0; 

            ctx.drawImage(fatherImg, canvas.width/2 - 150, 0, 140, 140);
            ctx.drawImage(motherImg, canvas.width/2 + 10, 0, 140, 140);
            
            if (monsterState === 'AWAKE') {
                ctx.fillStyle = "rgba(255,0,0,0.3)"; ctx.fillRect(canvas.width/2 - 150, 0, 300, 140);
            }
            ctx.restore();
        }

        // Draw Player
        if (sonImg.complete) {
            ctx.drawImage(sonImg, playerX, playerY, playerSize, playerSize);
            ctx.strokeStyle = isMoving ? "#00e5ff" : (panicLevel > 80 ? "#ff0000" : "#555");
            ctx.lineWidth = 3; ctx.strokeRect(playerX, playerY, playerSize, playerSize);
        }

        // Draw Shadow (Death from below)
        let grad = ctx.createLinearGradient(0, shadowY - 120, 0, shadowY);
        grad.addColorStop(0, "rgba(10, 0, 0, 0)"); grad.addColorStop(1, "rgba(10, 0, 0, 1)");
        ctx.fillStyle = grad; ctx.fillRect(0, shadowY - 120, canvas.width, 120);
        ctx.fillStyle = "#050000"; ctx.fillRect(0, shadowY, canvas.width, canvas.height - shadowY);


        // --- LOSS CONDITIONS ---
        // 1. Moved while awake
        if (isMoving && monsterState === 'AWAKE') triggerGameOver("THEY SAW YOU", Math.random() > 0.5 ? fatherImg.src : motherImg.src);
        
        // 2. Panic hit 100%
        if (panicLevel >= 100) triggerGameOver("YOU PANICKED", Math.random() > 0.5 ? fatherImg.src : motherImg.src);

        // 3. Shadow caught you
        if (shadowY < playerY + playerSize/2) triggerGameOver("CONSUMED BY DARK", sonImg.src);

        // --- WIN CONDITION ---
        if (playerY <= 80) stageComplete();
    }

    if (gameState === 'GAMEOVER') {
        ctx.fillStyle = "rgba(255,0,0,0.4)"; ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    requestAnimationFrame(draw);
}

// --- 6. GAME OVER & STAGES ---
function triggerGameOver(reasonText, killerImageSrc) {
    gameState = 'GAMEOVER';
    isMoving = false;
    
    jumpscareImg.src = killerImageSrc;
    jumpscareImg.classList.add('scare-active');

    crashMsg.innerText = reasonText;
    crashMsg.style.display = 'block';
    startBtn.style.display = 'inline-block';
    startBtn.innerText = "TRY AGAIN";
    instructions.style.display = 'none';
}

function stageComplete() {
    stage++;
    levelEl.innerText = "STAGE: " + stage;
    
    playerY = canvas.height - 120;
    shadowY = canvas.height;
    shadowSpeed += 0.2; // Shadow gets faster
    panicLevel = 0;
    
    monsterState = 'SLEEP';
    stateTimer = 100;
    spawnTraps();
    
    ctx.fillStyle = "rgba(0, 255, 0, 0.4)"; ctx.fillRect(0, 0, canvas.width, canvas.height);
}

// --- 7. INPUT HANDLING (MOBILE OPTIMIZED) ---
function handleInteractionStart(e) {
    e.preventDefault(); // CRITICAL for mobile
    if (gameState === 'PLAYING') {
        isMoving = true;
        updateTarget(e);
    }
}

function handleInteractionMove(e) {
    e.preventDefault(); // CRITICAL for mobile
    if (gameState === 'PLAYING' && isMoving) {
        updateTarget(e);
    }
}

function handleInteractionEnd(e) {
    e.preventDefault();
    isMoving = false;
}

function updateTarget(e) {
    let clientX = e.touches ? e.touches[0].clientX : e.clientX;
    let rect = canvas.getBoundingClientRect();
    targetX = clientX - rect.left - (playerSize / 2);
}

// Touch Events
window.addEventListener('touchstart', handleInteractionStart, { passive: false });
window.addEventListener('touchmove', handleInteractionMove, { passive: false });
window.addEventListener('touchend', handleInteractionEnd, { passive: false });
window.addEventListener('touchcancel', handleInteractionEnd, { passive: false });

// Mouse Events
window.addEventListener('mousedown', handleInteractionStart);
window.addEventListener('mousemove', handleInteractionMove);
window.addEventListener('mouseup', handleInteractionEnd);

startBtn.addEventListener('click', (e) => {
    e.stopPropagation(); 
    unlockAudio();
    
    gameState = 'PLAYING';
    stage = 1; levelEl.innerText = "STAGE: 1";
    playerY = canvas.height - 120; playerX = canvas.width / 2; targetX = playerX;
    shadowY = canvas.height; shadowSpeed = 0.8;
    isMoving = false; panicLevel = 0;
    monsterState = 'SLEEP'; stateTimer = 100;
    spawnTraps();

    jumpscareImg.classList.remove('scare-active');
    gameContainer.classList.remove('glitching');
    crashMsg.style.display = 'none';
    instructions.style.display = 'none';
    startBtn.style.display = 'none';
});

// Start loop
spawnTraps();
draw();
</script>
</body>
</html>
