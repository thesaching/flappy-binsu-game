<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Surrounded: The Anger Outbreak</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&display=swap');

        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: #000; display: flex; justify-content: center; align-items: center; 
            font-family: 'Creepster', cursive; overflow: hidden; 
            touch-action: none; user-select: none; -webkit-user-select: none;
        }
        
        #game-container { position: relative; width: 100%; height: 100%; max-width: 800px; background: #050000; }
        canvas { display: block; width: 100%; height: 100%; cursor: crosshair; }

        #ui { 
            position: absolute; top: 15px; width: 100%; color: #ff0000; 
            pointer-events: none; z-index: 10; display: flex; justify-content: space-between; 
            padding: 0 30px; box-sizing: border-box; text-shadow: 0 0 15px #ff0000;
        }
        
        h1 { margin: 0; font-size: 35px; letter-spacing: 2px; }
        .score-pop { transform: scale(1.3); text-shadow: 0 0 30px #fff !important; transition: all 0.1s; }

        #center-ui {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; pointer-events: auto; z-index: 20; width: 90%;
        }

        .instruction { font-size: 22px; color: #aaa; font-family: sans-serif; margin-bottom: 25px; line-height: 1.5; text-shadow: 2px 2px 4px #000;}
        .instruction span { color: #ff0000; font-weight: bold; }
        .crash-text { color: #ff0000; font-size: 65px; text-transform: uppercase; text-shadow: 0 0 30px #ff0000; margin-bottom: 10px; display: none;}
        
        #start-btn {
            padding: 15px 40px; font-size: 35px; background: rgba(0,0,0,0.9); color: #ff0000;
            border: 3px solid #ff0000; border-radius: 8px; cursor: pointer;
            box-shadow: 0 0 20px rgba(255,0,0,0.6); font-family: 'Creepster', cursive; letter-spacing: 2px;
        }

        @keyframes shake {
            0% { transform: translate(4px, 4px); } 20% { transform: translate(-4px, -4px); }
            40% { transform: translate(4px, -4px); } 60% { transform: translate(-4px, 4px); }
            80% { transform: translate(4px, 0); } 100% { transform: translate(-4px, 0); }
        }
        .shaking { animation: shake 0.3s; }
        
        #blood-vignette {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 40%, rgba(139,0,0,0.8) 100%);
            pointer-events: none; z-index: 5; animation: pulse 2s infinite alternate;
        }
        @keyframes pulse { 0% { opacity: 0.5; } 100% { opacity: 1; } }

        #jumpscare {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.1);
            width: 100%; height: 100%; object-fit: cover; opacity: 0; pointer-events: none; z-index: 15;
            transition: all 0.1s;
        }
        .scare-active { transform: translate(-50%, -50%) scale(1.3) !important; opacity: 1 !important; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="blood-vignette"></div>
        <img id="jumpscare" src="" alt="scare">
        
        <div id="ui">
            <h1 id="score">KILLS: 0</h1>
            <h1 id="wave" style="color: #aaa;">WAVE: 1</h1>
        </div>

        <div id="center-ui">
            <div id="crash-msg" class="crash-text">OVERWHELMED</div>
            <div id="instructions" class="instruction">
                You are trapped.<br>
                <span>TAP ANYWHERE</span> to shoot bursts of anger.<br>
                Do not let them reach the center.
            </div>
            <button id="start-btn">FIGHT TO SURVIVE</button>
        </div>
        
        <canvas id="gameCanvas"></canvas>
    </div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const waveEl = document.getElementById('wave');
const startBtn = document.getElementById('start-btn');
const crashMsg = document.getElementById('crash-msg');
const instructions = document.getElementById('instructions');
const gameContainer = document.getElementById('game-container');
const jumpscareImg = document.getElementById('jumpscare');

function resizeCanvas() {
    canvas.width = window.innerWidth > 800 ? 800 : window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// --- 1. AUDIO SETUP ---
const bgMusic = new Audio('https://raw.githubusercontent.com/thesaching/flappy-binsu-game/refs/heads/main/kir.mp3');
bgMusic.loop = true;
bgMusic.volume = 0.9; 
let audioUnlocked = false;

function unlockAudio() {
    if (!audioUnlocked) {
        bgMusic.play().catch(err => console.log("Audio waiting..."));
        audioUnlocked = true;
    }
}

// --- 2. LOAD IMAGES ---
const sonImg = new Image(); sonImg.crossOrigin = "anonymous";
sonImg.src = 'https://raw.githubusercontent.com/thesaching/flappy-binsu-game/refs/heads/main/varu.jpeg'; 

const fatherImg = new Image(); fatherImg.crossOrigin = "anonymous";
fatherImg.src = 'https://raw.githubusercontent.com/thesaching/flappy-binsu-game/refs/heads/main/easha.jpeg'; 

const motherImg = new Image(); motherImg.crossOrigin = "anonymous";
motherImg.src = 'https://raw.githubusercontent.com/thesaching/flappy-binsu-game/refs/heads/main/kavitha.jpeg'; 

// --- 3. GAME VARIABLES ---
let gameState = 'IDLE'; 
let kills = 0;
let wave = 1;
let frames = 0;

let cx = canvas.width / 2;
let cy = canvas.height / 2;
let playerSize = 70;

let enemies = [];
let bullets = [];
let particles = [];

let baseSpawnRate = 90;
let enemyBaseSpeed = 1.0;

// --- 4. GAME LOGIC ---
function spawnEnemy() {
    let angle = Math.random() * Math.PI * 2;
    let dist = Math.max(canvas.width, canvas.height) / 2 + 50;
    
    let ex = cx + Math.cos(angle) * dist;
    let ey = cy + Math.sin(angle) * dist;

    // HP increases as waves go up
    let hp = 1 + Math.floor(wave / 3); 
    let speed = enemyBaseSpeed + (Math.random() * 0.5);

    enemies.push({
        x: ex, y: ey, size: 85, 
        img: Math.random() > 0.5 ? fatherImg : motherImg,
        hp: hp, maxHp: hp, speed: speed, angle: angle
    });
}

function shoot(targetX, targetY) {
    if (gameState !== 'PLAYING') return;
    
    let angle = Math.atan2(targetY - cy, targetX - cx);
    let speed = 15;

    bullets.push({
        x: cx, y: cy,
        vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed,
        size: 10
    });
    
    // Tiny recoil shake for game feel
    gameContainer.classList.add('shaking');
    setTimeout(() => gameContainer.classList.remove('shaking'), 50);
}

function createBlood(x, y) {
    for(let i=0; i<10; i++) {
        particles.push({
            x: x, y: y, vx: (Math.random()-0.5)*8, vy: (Math.random()-0.5)*8,
            life: 15 + Math.random()*15, color: "#ff0000"
        });
    }
}

// --- 5. MAIN LOOP ---
function draw() {
    ctx.fillStyle = "rgba(5, 0, 0, 0.8)"; // Trailing effect background
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    if (gameState === 'PLAYING') {
        frames++;
        
        // Dynamic Wave Scaling
        wave = 1 + Math.floor(kills / 10);
        waveEl.innerText = "WAVE: " + wave;
        
        let currentSpawnRate = Math.max(20, baseSpawnRate - (wave * 5));
        enemyBaseSpeed = 1.0 + (wave * 0.1);

        if (frames % currentSpawnRate === 0) spawnEnemy();

        // --- UPDATE BULLETS ---
        ctx.fillStyle = "#ff0000"; ctx.shadowBlur = 15; ctx.shadowColor = "#ff0000";
        for (let i = bullets.length - 1; i >= 0; i--) {
            let b = bullets[i];
            b.x += b.vx; b.y += b.vy;
            
            ctx.beginPath(); ctx.arc(b.x, b.y, b.size, 0, Math.PI*2); ctx.fill();

            // Collision with enemies
            let hit = false;
            for (let j = enemies.length - 1; j >= 0; j--) {
                let e = enemies[j];
                let dist = Math.hypot(b.x - e.x, b.y - e.y);
                
                if (dist < e.size/2 + b.size) {
                    e.hp--;
                    createBlood(b.x, b.y);
                    
                    // Knockback effect
                    e.x -= Math.cos(e.angle) * 20;
                    e.y -= Math.sin(e.angle) * 20;
                    
                    hit = true;
                    if (e.hp <= 0) {
                        kills++;
                        scoreEl.innerText = "KILLS: " + kills;
                        scoreEl.classList.add('score-pop');
                        setTimeout(() => scoreEl.classList.remove('score-pop'), 150);
                        createBlood(e.x, e.y);
                        enemies.splice(j, 1);
                    }
                    break; 
                }
            }
            if (hit || b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
                bullets.splice(i, 1);
            }
        }
        ctx.shadowBlur = 0;

        // --- UPDATE ENEMIES ---
        for (let e of enemies) {
            // Recalculate angle to center just in case
            e.angle = Math.atan2(cy - e.y, cx - e.x);
            e.x += Math.cos(e.angle) * e.speed;
            e.y += Math.sin(e.angle) * e.speed;

            if (e.img.complete) {
                ctx.drawImage(e.img, e.x - e.size/2, e.y - e.size/2, e.size, e.size);
                ctx.strokeStyle = "#ff0000"; ctx.lineWidth = 2;
                ctx.strokeRect(e.x - e.size/2, e.y - e.size/2, e.size, e.size);
            }

            // Check if they reached the player!
            let distToPlayer = Math.hypot(cx - e.x, cy - e.y);
            if (distToPlayer < playerSize/2 + e.size/3) {
                triggerGameOver(e.img.src);
            }
        }

        // --- UPDATE PARTICLES ---
        for (let i = particles.length - 1; i >= 0; i--) {
            let p = particles[i];
            p.x += p.vx; p.y += p.vy; p.life--;
            ctx.fillStyle = p.color; ctx.globalAlpha = Math.max(0, p.life / 30); 
            ctx.fillRect(p.x, p.y, 5, 5);
            ctx.globalAlpha = 1.0;
            if (p.life <= 0) particles.splice(i, 1);
        }

        // --- DRAW PLAYER (CENTER) ---
        if (sonImg.complete) {
            ctx.drawImage(sonImg, cx - playerSize/2, cy - playerSize/2, playerSize, playerSize);
            ctx.strokeStyle = "#fff"; ctx.lineWidth = 3;
            ctx.strokeRect(cx - playerSize/2, cy - playerSize/2, playerSize, playerSize);
        }
    }

    if (gameState === 'GAMEOVER') {
        ctx.fillStyle = "rgba(255, 0, 0, 0.4)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    requestAnimationFrame(draw);
}

// --- 6. GAME OVER LOGIC ---
function triggerGameOver(killerImgSrc) {
    gameState = 'GAMEOVER';
    
    gameContainer.classList.add('shaking');
    setTimeout(() => gameContainer.classList.remove('shaking'), 500);

    jumpscareImg.src = killerImgSrc;
    jumpscareImg.classList.add('scare-active');

    crashMsg.style.display = 'block';
    startBtn.style.display = 'inline-block';
    startBtn.innerText = "FIGHT AGAIN";
    instructions.style.display = 'none';
}

// --- 7. INPUT HANDLING ---
function handleInteraction(e) {
    if (gameState !== 'PLAYING') return;
    e.preventDefault();
    let clientX = e.touches ? e.touches[0].clientX : e.clientX;
    let clientY = e.touches ? e.touches[0].clientY : e.clientY;
    let rect = canvas.getBoundingClientRect();
    shoot(clientX - rect.left, clientY - rect.top);
}

window.addEventListener('mousedown', handleInteraction);
window.addEventListener('touchstart', handleInteraction, { passive: false });

startBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    unlockAudio();
    
    gameState = 'PLAYING';
    kills = 0; wave = 1; frames = 0;
    scoreEl.innerText = "KILLS: 0";
    waveEl.innerText = "WAVE: 1";
    
    cx = canvas.width / 2; cy = canvas.height / 2;
    enemies = []; bullets = []; particles = [];

    jumpscareImg.classList.remove('scare-active');
    crashMsg.style.display = 'none';
    instructions.style.display = 'none';
    startBtn.style.display = 'none';
});

// Start loop
draw();
</script>
</body>
</html>
